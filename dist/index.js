(()=>{"use strict";var e={767:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(645),a=r.n(n)()((function(e){return e[1]}));a.push([e.id,"body {\r\n    background-color: white;\r\n    font-family: Arial, Helvetica, sans-serif;\r\n}\r\n\r\n.disabled {\r\n    pointer-events: none;\r\n    opacity: 0.4;\r\n}\r\n\r\n.header-wrapper {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 50px;\r\n    align-items: center;\r\n    margin: 5%;\r\n}\r\n.header__logo img{\r\n    width: 80%;\r\n}\r\n.header__buttons {\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: center;\r\n    column-gap: 5%;\r\n    margin-right: auto;\r\n}\r\n.header__buttons-button {\r\n    border-color: beige;\r\n    border-radius: 5px;\r\n    width: 160px;\r\n    height: 40px;\r\n    cursor: pointer;\r\n    background-color: rgb(244, 248, 170);\r\n}\r\n.button:hover {\r\n    border-color: green;\r\n}\r\n.main-wrapper {\r\n    margin: 50px 5%;\r\n}\r\n.main__buttons {\r\n    display: flex;\r\n    flex-direction: column;\r\n    row-gap: 20px;\r\n}\r\n.main-buttons {\r\n    display: flex;\r\n    flex-direction: row;\r\n    column-gap: 2%;\r\n    align-items: center;\r\n}\r\n.main__garage {\r\n    display: flex;\r\n    flex-direction: column;\r\n    row-gap: 30px;\r\n    height: 1000px;\r\n}\r\n.main__pagination {\r\n    margin: 0;\r\n    display: flex;\r\n    flex-direction: row;\r\n    column-gap: 2%;\r\n}\r\n\r\n.garage__head {\r\n    color: rgb(94, 2, 2);\r\n}\r\n.garage__track {\r\n    border-bottom: 5px dashed rgb(107, 1, 1);\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 10px;\r\n}\r\n.garage__track__head {\r\n    display: flex;\r\n    flex-direction: row;\r\n    column-gap: 2%;\r\n}\r\n.garage__track__head__buttons {\r\n    display: flex;\r\n    flex-direction: row;\r\n    column-gap: 2%;\r\n}\r\n.garage__track__line {\r\n    display: flex;\r\n    flex-direction: row;\r\n}\r\n.garage__track__line-vehicle {\r\n    width: 100px;\r\n    display: flex;\r\n    flex-direction: column;\r\n}\r\n.drive_text {\r\n    display: flex;\r\n    flex-direction: row;\r\n}\r\n\r\n.broken, .finished {\r\n    margin: 0;\r\n    opacity: 0;\r\n}\r\n\r\n.garage__track__line-vehicle-img {\r\n    width: 100%;\r\n    align-self: flex-end;\r\n}\r\n.garage__track__line-finish {\r\n    position: absolute;\r\n    right: 165px;\r\n    z-index: 10;\r\n    align-self: end;\r\n}\r\n.garage__track__line__buttons {\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: space-around;\r\n    width: 140px;\r\n    height: fit-content;\r\n}\r\n/* .garage__track__line__buttons-start, .garage__track__line__buttons-stop {\r\n    width: 70px;\r\n    height: 30px;\r\n} */\r\n\r\n.footer-info {\r\n    height: 50px;\r\n    margin: 5% 0 0 0;\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: center;\r\n    justify-content: center;\r\n    background-color: #4f4f4f;\r\n    color: #000;\r\n    font-weight: 500;\r\n    background-size: cover;\r\n    font-family: 'Ubuntu', sans-serif;\r\n    text-align: center;\r\n}\r\n\r\n.footer-git, .footer-p, .footer-rss {\r\n    width: 33%;\r\n}\r\n\r\n.footer-rss {\r\n    position: relative;\r\n    height: 100%;\r\n}\r\n\r\n.footer-git {\r\n    display: flex;\r\n    flex-direction: row;\r\n    color: #000;\r\n    gap: 10px;\r\n}\r\n\r\n.footer-git a {\r\n    text-decoration: none;\r\n    color: #000;\r\n}\r\n\r\n#git-img {\r\n    width: 100%;\r\n    height: 100%;\r\n    object-fit: contain;\r\n}\r\n\r\n#rss-img {\r\n    position: absolute;\r\n    right: 0;\r\n    object-fit: cover;\r\n    height: 100%;\r\n    \r\n}\r\n\r\n#view_winners {\r\n    display: none;\r\n}\r\n\r\n.winners_table {\r\n    border: 2px;\r\n}\r\n\r\n.table {\r\n\twidth: 100%;\r\n\tmargin-bottom: 20px;\r\n\tborder: 1px solid #dddddd;\r\n\tborder-collapse: collapse;\r\n    text-align: center;\r\n}\r\n.table th {\r\n\tfont-weight: bold;\r\n\tpadding: 5px;\r\n\tbackground: #efefef;\r\n\tborder: 1px solid #dddddd;\r\n}\r\n.table td {\r\n\tborder: 1px solid #dddddd;\r\n\tpadding: 5px;\r\n}\r\n\r\n.col_first {\r\n    color: beige;\r\n}\r\n\r\n.winner-vehicle-img {\r\n    width: 100px;\r\n}\r\n\r\n.winner_text h2 {\r\n    margin: 0;\r\n}\r\n\r\n.winner_text {\r\n    display: flex;\r\n    justify-content: center;\r\n    margin: 0 auto;\r\n}\r\n\r\n.main__garage_pagination_row {\r\n    display: flex;\r\n    flex-direction: row;\r\n}\r\n\r\n\r\n\r\n",""]);const i=a},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=e(t);return t[2]?"@media ".concat(t[2]," {").concat(r,"}"):r})).join("")},t.i=function(e,r,n){"string"==typeof e&&(e=[[null,e,""]]);var a={};if(n)for(var i=0;i<this.length;i++){var o=this[i][0];null!=o&&(a[o]=!0)}for(var s=0;s<e.length;s++){var d=[].concat(e[s]);n&&a[d[0]]||(r&&(d[2]?d[2]="".concat(r," and ").concat(d[2]):d[2]=r),t.push(d))}},t}},379:(e,t,r)=>{var n,a=function(){var e={};return function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}e[t]=r}return e[t]}}(),i=[];function o(e){for(var t=-1,r=0;r<i.length;r++)if(i[r].identifier===e){t=r;break}return t}function s(e,t){for(var r={},n=[],a=0;a<e.length;a++){var s=e[a],d=t.base?s[0]+t.base:s[0],c=r[d]||0,l="".concat(d," ").concat(c);r[d]=c+1;var u=o(l),m={css:s[1],media:s[2],sourceMap:s[3]};-1!==u?(i[u].references++,i[u].updater(m)):i.push({identifier:l,updater:_(m,t),references:1}),n.push(l)}return n}function d(e){var t=document.createElement("style"),n=e.attributes||{};if(void 0===n.nonce){var i=r.nc;i&&(n.nonce=i)}if(Object.keys(n).forEach((function(e){t.setAttribute(e,n[e])})),"function"==typeof e.insert)e.insert(t);else{var o=a(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var c,l=(c=[],function(e,t){return c[e]=t,c.filter(Boolean).join("\n")});function u(e,t,r,n){var a=r?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(e.styleSheet)e.styleSheet.cssText=l(t,a);else{var i=document.createTextNode(a),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(i,o[t]):e.appendChild(i)}}function m(e,t,r){var n=r.css,a=r.media,i=r.sourceMap;if(a?e.setAttribute("media",a):e.removeAttribute("media"),i&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}var g=null,h=0;function _(e,t){var r,n,a;if(t.singleton){var i=h++;r=g||(g=d(t)),n=u.bind(null,r,i,!1),a=u.bind(null,r,i,!0)}else r=d(t),n=m.bind(null,r,t),a=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(r)};return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else a()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n));var r=s(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var n=0;n<r.length;n++){var a=o(r[n]);i[a].references--}for(var d=s(e,t),c=0;c<r.length;c++){var l=o(r[c]);0===i[l].references&&(i[l].updater(),i.splice(l,1))}r=d}}}}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var i=t[n]={id:n,exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.nc=void 0,(()=>{const e={pageGarage:1,limit:7,pageWinners:1,limitWin:5,cars:[],carsWin:[],countCar:0,generateCount:10,countWinners:0,view:"garage",sort:"time",sortOrder:"ASC"},t=class{viewGarage(e){e.forEach((e=>{this.viewOneCar(e)}))}viewOneCar(e){const t=document.createDocumentFragment(),r=document.querySelector("#one_car");if(r){const n=r.content.cloneNode(!0),a=n.querySelector(".garage__track"),i=n.querySelector(".garage__track__head__buttons-remove"),o=n.querySelector(".garage__track__head__buttons-select"),s=n.querySelector(".garage__track__line__buttons-start"),d=n.querySelector(".garage__track__line__buttons-stop"),c=n.querySelector(".garage__track__head-name"),l=n.querySelector(".broken"),u=n.querySelector(".finished"),m=n.querySelector(".garage__track__line-vehicle"),g=n.querySelector(".garage__track__line-vehicle-img");c&&g&&m&&(c.textContent=e.name,g.style.backgroundColor=e.color,g.setAttribute("id",`img_${e.id}`),m.setAttribute("id",`img_block_${e.id}`)),a&&a.setAttribute("id",e.id.toString()),i&&o&&(i.setAttribute("id",`btn_remove_${e.id}`),o.setAttribute("id",`btn_select_${e.id}`)),s&&d&&(s.setAttribute("id",`btn_start_${e.id}`),d.setAttribute("id",`btn_stop_${e.id}`)),l&&u&&(l.setAttribute("id",`broke_${e.id}`),u.setAttribute("id",`finish_${e.id}`)),t.append(n)}const n=document.querySelector(".main__garage");n&&n.append(t)}tableWinnersTemplate(){const e=document.createDocumentFragment(),t=document.querySelector("#winners_table");if(t){const r=t.content.cloneNode(!0);e.append(r)}const r=document.getElementById("view_winners");r&&r.append(e)}tableWinners(t){document.getElementById("table_body").remove(),function(){const r=document.createElement("tbody");r.setAttribute("id","table_body"),document.getElementById("table").append(r);for(let n=0;n<t.length;n++){const a=r.insertRow(-1);a.insertCell(0).innerHTML=`${(e.pageWinners-1)*e.limitWin+n+1}`;const i=a.insertCell(1),o=document.createElement("img");o.src="./assets/car.png",o.alt="vehicle",o.setAttribute("class","winner-vehicle-img"),o.style.backgroundColor=t[n].color,i.appendChild(o),a.insertCell(2).innerHTML=`${t[n].name}`,a.insertCell(3).innerHTML=`${t[n].wins}`,a.insertCell(4).innerHTML=`${t[n].time}`}document.querySelector(".winners_count").innerHTML=`${e.countWinners} cars`,document.querySelector(".winners_page").innerHTML=`${e.pageWinners}`,console.log(e.pageWinners),console.log(e.countWinners)}()}},n=class{constructor(){this.view=new t,this.query=new class{constructor(){this.baseLink="http://127.0.0.1:3000/"}makeQueryParamPage(e){return e.queryParams?._page?`_page=${e.queryParams?._page}&`:""}makeQueryParamLimit(e){return e.queryParams?._limit?`_limit=${e.queryParams?._limit}&`:""}makeQueryParamSort(e){return e.queryParams?._sort?`_sort=${e.queryParams?._sort}&`:""}makeQueryParamOrder(e){return e.queryParams?._order?`_order=${e.queryParams?._order}&`:""}makeQueryParamID(e){return e.queryParams?.id?`id=${e.queryParams.id}&`:""}makeQueryParamStatus(e){return e.queryParams?.status?`status=${e.queryParams.status}&`:""}makeUrlParamID(e){return e.urlParams?.id?`/${e.urlParams.id}`:""}queryMakerMethod(e){return"GET"===e.method?{url:`${this.baseLink}${e.url}${this.makeUrlParamID(e)}${this.makeQueryParamPage(e)}${this.makeQueryParamLimit(e)}${this.makeQueryParamSort(e)}${this.makeQueryParamOrder(e)}`,method:e.method}:"DELETE"===e.method?{url:`${this.baseLink}${e.url}${this.makeUrlParamID}`,method:e.method}:"POST"===e.method?{url:`${this.baseLink}${e.url}`,method:e.method,header:e.header,body:JSON.stringify(e.data)}:"PUT"===e.method?{url:`${this.baseLink}${e.url}${this.makeUrlParamID}`,method:e.method,header:e.header,data:e.data}:{url:`${this.baseLink}${e.url}${this.makeQueryParamID}&${this.makeQueryParamStatus}`,method:e.method}}queryMakerPOSTQuery(e){return{url:`${this.baseLink}${e.url}`,method:e.method,header:e.header,body:e.body}}queryMakerDELETEQuery(e){return{url:`${this.baseLink}${e.url}/${e.id}`,method:e.method}}queryMakerGETOneQuery(e){return{url:`${this.baseLink}${e.url}/${e.id}`,method:e.method}}queryMakerUpdateQuery(e){return{url:`${this.baseLink}${e.url}/${e.id}`,method:e.method,header:e.header,body:e.body}}queryMakerEngine(e){return{url:`${this.baseLink}${e.url}?id=${e.id}&status=${e.status}`,method:e.method}}queryMakerWinnersPageQuery(e){return{url:`${this.baseLink}${e.url}?_page=${e.page}&_limit=${e.limit}&_sort=${e.sort}&_order=${e.order}`,method:e.method}}queryMakerWinnersQuery(e){return{url:`${this.baseLink}${e.url}?_sort=${e.sort}&_order=${e.order}`,method:e.method}}},this.loader=new class{async getRespPage(e,t,r){const n=await fetch(`${e.url}?_page=${t}&_limit=${r}`,{method:e.method});return{cars:await n.json(),count:Number(n.headers.get("X-Total-Count"))}}async getResp(e){const t=await fetch(`${e.url}`,{method:e.method});return await(await t).json()}async createRespOneCar(e){const t=fetch(e.url,{method:e.method,headers:e.header,body:e.body});return await(await t).json()}async deleteRespCar(e){const t=await fetch(e.url,{method:e.method});if(t.ok)return await t.json();alert("Ошибка HTTP: "+t.status)}async getRespOneCar(e){const t=await fetch(e.url,{method:e.method});if(t.ok)return await t.json()}async getRespOneWinner(e){const t=await fetch(e.url,{method:e.method}).then((e=>e.json())).catch((e=>{404!==e.status||console.log("ошибка 404")}));return await t}async updateCar(e){const t=fetch(e.url,{method:e.method,headers:e.header,body:e.body});return await(await t).json()}async getStartStop(e){const t=await fetch(e.url,{method:e.method});return await t.json()}async getDrive(e){const t=await fetch(e.url,{method:e.method});if(t.ok)return await t.json();console.log("Ошибка HTTP: "+t.status)}async getRespWinsPage(e){const t=await fetch(`${e.url}`,{method:e.method});return{carsWin:await t.json(),countWin:Number(t.headers.get("X-Total-Count"))}}async getRespWins(e){const t=await fetch(`${e.url}`,{method:e.method});return await t.json()}}}async start(){document.querySelectorAll(".garage__track").forEach((e=>{e.remove()}));const t=await this.loader.getRespPage(this.query.queryMakerMethod({url:"garage",method:"GET"}),e.pageGarage,e.limit);this.view.viewGarage(t.cars),e.cars=t.cars,e.countCar=t.count;const r=document.querySelector(".garage_count"),n=document.querySelector(".garage_pages"),a=Math.ceil(e.countCar/e.limit),i=document.querySelector(".garage__head-page-number");r&&(r.innerHTML=`${e.countCar} cars`),n&&i&&(n.innerHTML=`${a}`,i.innerHTML=`${e.pageGarage}`)}async getGarage(){return await this.loader.getResp(this.query.queryMakerMethod({url:"garage",method:"GET"}))}clear(){document.querySelectorAll(".garage__track").forEach((e=>{e.remove()}))}async createCar(e){const t=JSON.stringify(e);await this.loader.createRespOneCar(this.query.queryMakerPOSTQuery({url:"garage",method:"POST",header:{"Content-Type":"application/json"},body:t})),await this.start()}async generateCars(e){await Promise.all(e.map((async e=>await this.createCar(e)))),await this.start()}async deleteCar(e){const t=Number(e);await this.loader.deleteRespCar(this.query.queryMakerDELETEQuery({url:"garage",method:"DELETE",id:t}))}async getCar(e){const t=Number(e);return await this.loader.getRespOneCar(this.query.queryMakerGETOneQuery({url:"garage",method:"GET",id:t}))}async updateCar(e){const t=JSON.stringify(e);return await this.loader.updateCar(this.query.queryMakerUpdateQuery({url:"garage",id:Number(e.id),method:"PUT",header:{"Content-Type":"application/json"},body:t}))}async startStopEngine(e,t){return await this.loader.getStartStop(this.query.queryMakerEngine({url:"engine",method:"PATCH",id:e,status:t}))}async drive(e,t){return await this.loader.getDrive(this.query.queryMakerEngine({url:"engine",method:"PATCH",id:e,status:t}))}async createWinner(e){const t=JSON.stringify(e);await this.loader.createRespOneCar(this.query.queryMakerPOSTQuery({url:"winners",method:"POST",header:{"Content-Type":"application/json"},body:t}))}async getWinnersPage(){const t={url:"winners",method:"GET",page:e.pageWinners,limit:e.limitWin,sort:e.sort,order:e.sortOrder},r=await this.loader.getRespWinsPage(this.query.queryMakerWinnersPageQuery(t));return e.carsWin=r.carsWin,e.countWinners=r.countWin,r}async getWinners(){return await this.loader.getRespWins(this.query.queryMakerWinnersQuery({url:"winners",method:"GET",sort:"time",order:"ASC"}))}async getWinner(e){return await this.loader.getRespOneCar(this.query.queryMakerGETOneQuery({url:"winners",method:"GET",id:e}))}async deleteWinner(e){await this.loader.deleteRespCar(this.query.queryMakerDELETEQuery({url:"winners",method:"DELETE",id:e}))}async updateWinner(e){const t=JSON.stringify(e);return await this.loader.updateCar(this.query.queryMakerUpdateQuery({url:"winners",id:e.id,method:"PUT",header:{"Content-Type":"application/json"},body:t}))}},a=new n,i=new t,o=class{addListener(e,t,r){e instanceof NodeList?e.forEach((e=>{e.addEventListener(t,r)})):e.addEventListener(t,r)}readOptionsForCreateQuery(){const e=document.getElementById("create__name"),t=document.getElementById("create__color");return{url:"garage",method:"POST",header:{"Content-Type":"application/json"},data:{name:e.value,color:t.value}}}readOptionsForUpdateQuery(e){const t=document.getElementById("update__name"),r=document.getElementById("update__color");return{url:"garage",method:"PUT",header:{"Content-Type":"application/json"},data:{name:t.value,color:r.value,id:e}}}lockUnlockElement(e){e.classList.contains("disabled")?e.classList.remove("disabled"):e.classList.add("disabled")}generateCars(e){const t=["Lada","Nissan","Ford","Subaru","Kia","Mazda","Toyota","Suzuki","Renault","Hyunday","Honda","Volvo","UAZ","Skoda"],r=["Kalina","Jimny","Pathfinder","Explorer","Civic","Solaris","Accord","Patriot","XC70","Impreza","Camry","Land Rover","Discovery","Sandero","Priora","Rio","Cerato","Getz","Picanto","Optima","Rapid"];return new Array(e).fill(0).map((()=>({name:`${t[Math.floor(Math.random()*t.length)]} ${r[Math.floor(Math.random()*r.length)]}`,color:"#"+("00000"+Math.floor(Math.random()*Math.pow(16,6)).toString(16)).slice(-6)})))}async getdataWins(){const e=await a.getWinners(),t=await a.getGarage(),r=[];return e.forEach((e=>{t.forEach((t=>{if(t.id===e.id){const n=Object.assign({},t,e);r.push(n)}}))})),console.log("dataWin",e),console.log("dataCar",t),r}async getdataWinsPage(){console.log("stateWin",e.pageWinners);const t=await a.getWinnersPage(),r=await a.getGarage(),n=[];return t.carsWin.forEach((e=>{r.forEach((t=>{if(t.id===e.id){const r=Object.assign({},t,e);n.push(r)}}))})),console.log("dataWin",t),console.log("dataCar",r),n}async NumberWins(e){if(e.id&&e.time){const t=(await a.getWinners()).find((t=>t.id===e.id));if(void 0===t){const t={id:e.id,wins:1,time:e.time};await a.createWinner(t)}else if(e.time<t.time){const r={id:e.id,wins:t.wins+=1,time:e.time};await a.updateWinner(r)}else{const r={id:e.id,wins:t.wins+=1,time:t.time};await a.updateWinner(r)}}}paginationWinners(){const t=document.querySelector(".winners__pagination_next"),r=document.querySelector(".winners__pagination_prev");e.pageWinners*e.limitWin>e.countWinners&&t.classList.add("disabled"),document.body.addEventListener("click",(async n=>{const a=n.target;if(a===t){e.pageWinners++;const t=await this.getdataWinsPage();i.tableWinners(t)}if(a===r){e.pageWinners--;const t=await this.getdataWinsPage();i.tableWinners(t)}1===e.pageWinners?(r.classList.add("disabled"),t.classList.remove("disabled")):r.classList.remove("disabled"),e.pageWinners*e.limitWin<e.countWinners?t.classList.remove("disabled"):t.classList.add("disabled")}))}sortWinners(){const t=document.getElementById("sort__time_up"),r=document.getElementById("sort__time_down"),n=document.getElementById("sort__wins_up"),a=document.getElementById("sort__wins_down");document.body.addEventListener("click",(async o=>{const s=o.target;if(s===t){e.sort="time",e.sortOrder="ASC";const t=await this.getdataWinsPage();i.tableWinners(t)}if(s===r){e.sort="time",e.sortOrder="DESC";const t=await this.getdataWinsPage();i.tableWinners(t)}if(s===n){e.sort="wins",e.sortOrder="ASC";const t=await this.getdataWinsPage();i.tableWinners(t)}if(s===a){e.sort="wins",e.sortOrder="DESC";const t=await this.getdataWinsPage();i.tableWinners(t)}}))}};var s=r(379),d=r.n(s),c=r(767);d()(c.Z,{insert:"head",singleton:!1}),c.Z.locals;const l=new n,u=new o,m=new n,g=new o,h=new class{async startEngine(e){const t=document.getElementById(`btn_start_${e}`);document.getElementById(`btn_stop_${e}`).classList.remove("disabled"),t.classList.add("disabled");const r=await l.startStopEngine(e,"started"),n=r.distance/r.velocity;this.animation(e,n);const a=await l.drive(e,"drive");if(void 0===a){const t=document.getElementById(`img_block_${e}`),r=document.getElementById(`broke_${e}`);t&&r&&(t.getAnimations({subtree:!0}).map((e=>e.pause())),r.style.opacity="1")}return{id:e,timeAnimation:n,responce:a}}async stopEngine(e){const t=document.getElementById(`btn_start_${e}`),r=document.getElementById(`btn_stop_${e}`),n=document.getElementById(`broke_${e}`),a=document.getElementById(`finish_${e}`);t.classList.remove("disabled"),r.classList.add("disabled"),await l.startStopEngine(e,"stopped");const i=document.getElementById(`img_block_${e}`);i.getAnimations({subtree:!0}).map((e=>e.cancel())),i.style.transform="translate(0)",n.style.opacity="0",a.style.opacity="0"}async race(){const t=document.querySelector(".main__buttons__race-reset"),r=document.querySelector(".main__buttons__race-race");t.classList.add("disabled"),r.classList.add("disabled");const n=e.cars.map((async e=>await this.startEngine(e.id))),a=await this.raceAll(n,e.cars.map((e=>e.id)));return await u.NumberWins(a),document.querySelector(".winner_text_scoreboard").innerHTML=`${a.name} is winner, time ${a.time} c`,console.log(a),await Promise.all(n),a}async raceAll(t,r){const{id:n,timeAnimation:a,responce:i}=await Promise.race(t);if(!i){const e=r.findIndex((e=>e===n)),a=[...t.slice(0,e),...t.slice(e+1,t.length)],i=[...r.slice(0,e),...r.slice(e+1,r.length)];return this.raceAll(a,i)}return{...e.cars.find((e=>e.id===n)),time:+(a/1e3).toFixed(2)}}raceAllAnimate(){document.getAnimations().forEach((async e=>{e.addEventListener("finish",(()=>{console.log("win",e.currentTime)}))}))}async resetRace(){const t=e.cars;await Promise.all(t.map((async e=>await this.stopEngine(e.id))))}animation(e,t){const r=document.querySelector(".garage__track__line")?.clientWidth,n=document.getElementById(`img_block_${e}`),a=document.getElementById(`finish_${e}`);if(n&&r){const e=n.animate([{transform:"translate(0)"},{transform:`translate(${r-245}px, 0)`}],t);if(e)return e.addEventListener("finish",(function(){n&&a&&(n.style.transform=`translate(${r-245}px, 0)`,a.style.opacity="1")})),e}}},_=new t,y=new n,p=new class{addListenerButtons(){document.body.addEventListener("click",(async t=>{const r=t.target,n=document.querySelector(".main__buttons__update");if(r.classList.contains("garage__track__head__buttons-remove")){const t=+r.id.split("btn_remove_")[1];await m.deleteCar(t.toString()),void 0!==(await m.getWinners()).find((e=>e.id===t))&&await m.deleteWinner(t),await m.start(),0===e.cars.length&&e.pageGarage>1&&(e.pageGarage--,await m.start())}if(r.classList.contains("main__buttons__create-create")){const t=g.readOptionsForCreateQuery();await m.createCar(t.data);const r=document.querySelector(".main__pagination-next");e.pageGarage*e.limit<e.countCar&&r.classList.remove("disabled")}if(r.classList.contains("garage__track__head__buttons-select")&&n.classList.contains("disabled")){const e=+r.id.split("btn_select_")[1],t=await m.getCar(e.toString()),a=document.getElementById("update__name"),i=document.getElementById("update__color"),o=document.querySelector(".button_update");n&&g.lockUnlockElement(n),a.value=t.name,i.value=t.color,o?.addEventListener("click",(async()=>{g.lockUnlockElement(n);const t=g.readOptionsForUpdateQuery(e);await m.updateCar(t.data),a.value="",i.value="#000000",await m.start()}),{once:!0})}if(r.classList.contains("main__buttons__race-generate")){const t=e.generateCount,r=g.generateCars(t);await m.generateCars(r);const n=document.querySelector(".main__pagination-next");e.pageGarage*e.limit<e.countCar&&n.classList.remove("disabled")}}))}pagination(){const t=document.querySelector(".garage__head-page-number"),r=document.querySelector(".main__pagination-next"),n=document.querySelector(".main__pagination-prev");e.pageGarage*e.limit<e.countCar&&r.classList.remove("disabled"),document.body.addEventListener("click",(a=>{const i=a.target;i===r&&(e.pageGarage++,m.start()),i===n&&(e.pageGarage--,m.start()),t&&(t.innerHTML=e.pageGarage.toString()),1===e.pageGarage?(n.classList.add("disabled"),r.classList.remove("disabled")):n.classList.remove("disabled"),e.pageGarage*e.limit<e.countCar?r.classList.remove("disabled"):r.classList.add("disabled")}))}addListenerDriving(){document.body.addEventListener("click",(async e=>{const t=e.target;if(t.classList.contains("garage__track__line__buttons-start")){const e=+t.id.split("btn_start_")[1];h.startEngine(e)}if(t.classList.contains("garage__track__line__buttons-stop")){const e=+t.id.split("btn_stop_")[1];h.stopEngine(e)}if(t.classList.contains("main__buttons__race-race")){const e=document.querySelector(".main__buttons__race-reset");await h.race(),e.classList.remove("disabled")}if(t.classList.contains("main__buttons__race-reset")){await h.resetRace();const e=document.querySelector(".winner_text_scoreboard"),t=document.querySelector(".main__buttons__race-race");e.innerHTML="",t.classList.remove("disabled")}}))}viewGarageWinners(){document.body.addEventListener("click",(async t=>{const r=t.target,n=document.querySelector(".button_toGarage"),a=document.querySelector(".button_toWinners"),i=document.getElementById("view_garage"),o=document.getElementById("view_winners");if(r===n&&(o.style.display="none",i.style.display="block",g.lockUnlockElement(n),g.lockUnlockElement(a),e.view="garage"),r===a){i.style.display="none",o.style.display="block",g.lockUnlockElement(a),g.lockUnlockElement(n),e.view="winners";const t=await g.getdataWinsPage();_.tableWinners(t);const r=document.querySelector(".winners__pagination_next");e.pageWinners*e.limitWin<e.countWinners?r.classList.remove("disabled"):r.classList.add("disabled")}}))}},b=new t,f=new o;(async()=>{await y.start(),b.tableWinnersTemplate(),p.addListenerButtons(),p.pagination(),p.addListenerDriving(),p.viewGarageWinners(),f.paginationWinners(),f.sortWinners()})()})()})();