(()=>{"use strict";var e={767:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(645),a=n.n(r)()((function(e){return e[1]}));a.push([e.id,"body {\r\n    background-color: white;\r\n    font-family: 'Ubuntu', sans-serif;\r\n    font-weight: 600;\r\n}\r\n\r\n.disabled {\r\n    pointer-events: none;\r\n    opacity: 0.4;\r\n}\r\n\r\n.header-wrapper {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 50px;\r\n    align-items: center;\r\n    margin: 5%;\r\n}\r\n.header__logo img{\r\n    width: 80%;\r\n}\r\n\r\n.header__logo {\r\n    display: flex;\r\n    justify-content: center;\r\n}\r\n\r\n.header__buttons {\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: center;\r\n    column-gap: 5%;\r\n    margin-right: auto;\r\n}\r\n.header__buttons-button {\r\n    border-radius: 5px;\r\n    width: 160px;\r\n    height: 40px;\r\n    cursor: pointer;\r\n}\r\n\r\n.main-wrapper {\r\n    margin: 50px 5%;\r\n}\r\n.main__buttons {\r\n    display: flex;\r\n    flex-direction: column;\r\n    row-gap: 20px;\r\n}\r\n.main-buttons {\r\n    display: flex;\r\n    flex-direction: row;\r\n    column-gap: 2%;\r\n    align-items: center;\r\n}\r\n.main__garage {\r\n    display: flex;\r\n    flex-direction: column;\r\n    row-gap: 30px;\r\n    height: 1000px;\r\n}\r\n.main__pagination {\r\n    margin: 0;\r\n    display: flex;\r\n    flex-direction: row;\r\n    column-gap: 2%;\r\n}\r\n\r\n.garage__head {\r\n    color: rgb(94, 2, 2);\r\n}\r\n.garage__track {\r\n    border-bottom: 5px dashed rgb(107, 1, 1);\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 10px;\r\n}\r\n.garage__track__head {\r\n    display: flex;\r\n    flex-direction: row;\r\n    column-gap: 2%;\r\n}\r\n\r\n.garage__track__line {\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: center;\r\n}\r\n.garage__track__line-vehicle {\r\n    width: 100px;\r\n    display: flex;\r\n    flex-direction: column;\r\n}\r\n.drive_text {\r\n    display: flex;\r\n    flex-direction: row;\r\n}\r\n\r\n.broken, .finished {\r\n    margin: 0;\r\n    opacity: 0;\r\n}\r\n\r\n.garage__track__line-vehicle-img {\r\n    width: 100%;\r\n    align-self: flex-end;\r\n}\r\n.garage__track__line-finish {\r\n    position: absolute;\r\n    right: 165px;\r\n    z-index: 10;\r\n    align-self: end;\r\n}\r\n\r\n.garage__track__line__buttons-start, .garage__track__line__buttons-stop,\r\n.garage__track__head__buttons-select, .garage__track__head__buttons-remove {\r\n    width: 65px;\r\n}\r\n\r\n.garage__track__line__buttons, .garage__track__head__buttons {\r\n    display: flex;\r\n    flex-direction: row;\r\n    justify-content: space-around;\r\n    width: 140px;\r\n    height: fit-content;\r\n}\r\n\r\n.main__buttons__race-race, .main__buttons__race-reset {\r\n    width: 80px;\r\n    height: 30px;\r\n}\r\n\r\n.main__buttons__race-generate {\r\n    width: 130px;\r\n    height: 30px;\r\n}\r\n\r\n.button_pag {\r\n    width: 70px;\r\n    height: 30px;\r\n    background-color: #b3b2b2;\r\n}\r\n\r\n.footer-info {\r\n    height: 50px;\r\n    margin: 5% 0 0 0;\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: center;\r\n    justify-content: center;\r\n    background-color: #BF3030;\r\n    color: #000;\r\n    font-weight: 500;\r\n    background-size: cover;\r\n    font-family: 'Ubuntu', sans-serif;\r\n    text-align: center;\r\n}\r\n\r\n.footer-git, .footer-p, .footer-rss {\r\n    width: 33%;\r\n}\r\n\r\n.footer-rss {\r\n    position: relative;\r\n    height: 100%;\r\n}\r\n\r\n.footer-git {\r\n    display: flex;\r\n    flex-direction: row;\r\n    color: #000;\r\n    gap: 10px;\r\n}\r\n\r\n.footer-git a {\r\n    text-decoration: none;\r\n    color: #000;\r\n}\r\n\r\n#git-img {\r\n    width: 100%;\r\n    height: 100%;\r\n    object-fit: contain;\r\n}\r\n\r\n#rss-img {\r\n    position: absolute;\r\n    right: 0;\r\n    object-fit: cover;\r\n    height: 100%;\r\n    \r\n}\r\n\r\n#view_winners {\r\n    display: none;\r\n}\r\n\r\n.winners_table {\r\n    border: 2px;\r\n}\r\n\r\n.table {\r\n\twidth: 100%;\r\n\tmargin-bottom: 20px;\r\n\tborder: 1px solid #dddddd;\r\n\tborder-collapse: collapse;\r\n    text-align: center;\r\n}\r\n.table th {\r\n\tfont-weight: bold;\r\n\tpadding: 5px;\r\n\tbackground: #efefef;\r\n\tborder: 1px solid #dddddd;\r\n}\r\n.table td {\r\n\tborder: 1px solid #dddddd;\r\n\tpadding: 5px;\r\n}\r\n\r\n.winner-vehicle-img {\r\n    width: 100px;\r\n}\r\n\r\n.winner_text h2 {\r\n    margin: 0;\r\n}\r\n\r\n.winner_text {\r\n    display: flex;\r\n    justify-content: center;\r\n    margin: 0 auto;\r\n    color: #BF3030;\r\n    white-space: pre-line;\r\n    text-align: center;\r\n    font-weight: 600;\r\n}\r\n\r\n.main__garage_pagination_row {\r\n    display: flex;\r\n    flex-direction: row;\r\n}\r\n\r\n.button {\r\n    font-weight: 600;\r\n    color: #BF3030\t;\r\n    text-decoration: none;\r\n    padding: 0.4em;\r\n    border-radius: 3px;\r\n    border: none;\r\n    box-shadow: 0 0 0.2em rgba(0, 0, 0, .8);\r\n    font-family: 'Ubuntu', sans-serif;\r\n}\r\n\r\n.button:hover {\r\n    cursor: pointer;\r\n    background-color: #BF3030;\r\n    color: #000;\r\n}",""]);const i=a},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,r){"string"==typeof e&&(e=[[null,e,""]]);var a={};if(r)for(var i=0;i<this.length;i++){var o=this[i][0];null!=o&&(a[o]=!0)}for(var s=0;s<e.length;s++){var c=[].concat(e[s]);r&&a[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},379:(e,t,n)=>{var r,a=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),i=[];function o(e){for(var t=-1,n=0;n<i.length;n++)if(i[n].identifier===e){t=n;break}return t}function s(e,t){for(var n={},r=[],a=0;a<e.length;a++){var s=e[a],c=t.base?s[0]+t.base:s[0],d=n[c]||0,l="".concat(c," ").concat(d);n[c]=d+1;var u=o(l),g={css:s[1],media:s[2],sourceMap:s[3]};-1!==u?(i[u].references++,i[u].updater(g)):i.push({identifier:l,updater:p(g,t),references:1}),r.push(l)}return r}function c(e){var t=document.createElement("style"),r=e.attributes||{};if(void 0===r.nonce){var i=n.nc;i&&(r.nonce=i)}if(Object.keys(r).forEach((function(e){t.setAttribute(e,r[e])})),"function"==typeof e.insert)e.insert(t);else{var o=a(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var d,l=(d=[],function(e,t){return d[e]=t,d.filter(Boolean).join("\n")});function u(e,t,n,r){var a=n?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(e.styleSheet)e.styleSheet.cssText=l(t,a);else{var i=document.createTextNode(a),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(i,o[t]):e.appendChild(i)}}function g(e,t,n){var r=n.css,a=n.media,i=n.sourceMap;if(a?e.setAttribute("media",a):e.removeAttribute("media"),i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}var m=null,_=0;function p(e,t){var n,r,a;if(t.singleton){var i=_++;n=m||(m=c(t)),r=u.bind(null,n,i,!1),a=u.bind(null,n,i,!0)}else n=c(t),r=g.bind(null,n,t),a=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else a()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r));var n=s(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var r=0;r<n.length;r++){var a=o(n[r]);i[a].references--}for(var c=s(e,t),d=0;d<n.length;d++){var l=o(n[d]);0===i[l].references&&(i[l].updater(),i.splice(l,1))}n=c}}}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={id:r,exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0,(()=>{const e={pageGarage:1,limit:7,pageWinners:1,limitWin:10,cars:[],carsWin:[],countCar:0,generateCount:100,countWinners:0,view:"garage",sort:"time",sortOrder:"ASC"},t=class{viewGarage(e){e.forEach((e=>{this.viewOneCar(e)}))}viewOneCar(e){const t=document.createDocumentFragment(),n=document.querySelector("#one_car");if(n){const r=n.content.cloneNode(!0),a=r.querySelector(".garage__track"),i=r.querySelector(".garage__track__head__buttons-remove"),o=r.querySelector(".garage__track__head__buttons-select"),s=r.querySelector(".garage__track__line__buttons-start"),c=r.querySelector(".garage__track__line__buttons-stop"),d=r.querySelector(".garage__track__head-name"),l=r.querySelector(".broken"),u=r.querySelector(".finished"),g=r.querySelector(".garage__track__line-vehicle"),m=r.querySelector(".garage__track__line-vehicle-img");d&&m&&g&&(d.textContent=e.name,m.style.backgroundColor=e.color,m.setAttribute("id",`img_${e.id}`),g.setAttribute("id",`img_block_${e.id}`)),a&&a.setAttribute("id",e.id.toString()),i&&o&&(i.setAttribute("id",`btn_remove_${e.id}`),o.setAttribute("id",`btn_select_${e.id}`)),s&&c&&(s.setAttribute("id",`btn_start_${e.id}`),c.setAttribute("id",`btn_stop_${e.id}`)),l&&u&&(l.setAttribute("id",`broke_${e.id}`),u.setAttribute("id",`finish_${e.id}`)),t.append(r)}const r=document.querySelector(".main__garage");r&&r.append(t)}tableWinnersTemplate(){const e=document.createDocumentFragment(),t=document.querySelector("#winners_table");if(t){const n=t.content.cloneNode(!0);e.append(n)}const n=document.getElementById("view_winners");n&&n.append(e)}tableWinners(t){document.getElementById("table_body").remove(),function(){const n=document.createElement("tbody");n.setAttribute("id","table_body"),document.getElementById("table").append(n);for(let r=0;r<t.length;r++){const a=n.insertRow(-1);a.insertCell(0).innerHTML=`${(e.pageWinners-1)*e.limitWin+r+1}`;const i=a.insertCell(1),o=document.createElement("img");o.src="./assets/car.png",o.alt="vehicle",o.setAttribute("class","winner-vehicle-img"),o.style.backgroundColor=t[r].color,i.appendChild(o),a.insertCell(2).innerHTML=`${t[r].name}`,a.insertCell(3).innerHTML=`${t[r].wins}`,a.insertCell(4).innerHTML=`${t[r].time}`}document.querySelector(".winners_count").innerHTML=`${e.countWinners} cars`,document.querySelector(".winners_page").innerHTML=`${e.pageWinners}`,console.log(e.pageWinners),console.log(e.countWinners)}()}},r=class{constructor(){this.view=new t,this.query=new class{constructor(){this.baseLink="http://127.0.0.1:3000/"}queryMakerMethod(e){return{url:`${this.baseLink}${e.url}`,method:e.method}}queryMakerPOSTQuery(e){return{url:`${this.baseLink}${e.url}`,method:e.method,header:e.header,body:e.body}}queryMakerDELETEQuery(e){return{url:`${this.baseLink}${e.url}/${e.id}`,method:e.method}}queryMakerGETOneQuery(e){return{url:`${this.baseLink}${e.url}/${e.id}`,method:e.method}}queryMakerUpdateQuery(e){return{url:`${this.baseLink}${e.url}/${e.id}`,method:e.method,header:e.header,body:e.body}}queryMakerEngine(e){return{url:`${this.baseLink}${e.url}?id=${e.id}&status=${e.status}`,method:e.method}}queryMakerWinnersPageQuery(e){return{url:`${this.baseLink}${e.url}?_page=${e.page}&_limit=${e.limit}&_sort=${e.sort}&_order=${e.order}`,method:e.method}}queryMakerWinnersQuery(e){return{url:`${this.baseLink}${e.url}?_sort=${e.sort}&_order=${e.order}`,method:e.method}}},this.loader=new class{async getRespPage(e,t,n){const r=await fetch(`${e.url}?_page=${t}&_limit=${n}`,{method:e.method});return{cars:await r.json(),count:Number(r.headers.get("X-Total-Count"))}}async getResp(e){const t=await fetch(`${e.url}`,{method:e.method});return await(await t).json()}async createRespOneCar(e){const t=fetch(e.url,{method:e.method,headers:e.header,body:e.body});return await(await t).json()}async deleteRespCar(e){const t=await fetch(e.url,{method:e.method});if(t.ok)return await t.json();alert("Ошибка HTTP: "+t.status)}async getRespOneCar(e){const t=await fetch(e.url,{method:e.method});if(t.ok)return await t.json()}async getRespOneWinner(e){const t=await fetch(e.url,{method:e.method}).then((e=>e.json())).catch((e=>{404!==e.status||console.log("ошибка 404")}));return await t}async updateCar(e){const t=fetch(e.url,{method:e.method,headers:e.header,body:e.body});return await(await t).json()}async getStartStop(e){const t=await fetch(e.url,{method:e.method});return await t.json()}async getDrive(e){const t=await fetch(e.url,{method:e.method});if(t.ok)return await t.json();console.log("Двигатель сломан"+t.status)}async getRespWinsPage(e){const t=await fetch(`${e.url}`,{method:e.method});return{carsWin:await t.json(),countWin:Number(t.headers.get("X-Total-Count"))}}async getRespWins(e){const t=await fetch(`${e.url}`,{method:e.method});return await t.json()}}}async start(){document.querySelectorAll(".garage__track").forEach((e=>{e.remove()}));const t=await this.loader.getRespPage(this.query.queryMakerMethod({url:"garage",method:"GET"}),e.pageGarage,e.limit);this.view.viewGarage(t.cars),e.cars=t.cars,e.countCar=t.count;const n=document.querySelector(".garage_count"),r=document.querySelector(".garage_pages"),a=Math.ceil(e.countCar/e.limit),i=document.querySelector(".garage__head-page-number");n&&(n.innerHTML=`${e.countCar} cars`),r&&i&&(r.innerHTML=`${a}`,i.innerHTML=`${e.pageGarage}`)}async getGarage(){return await this.loader.getResp(this.query.queryMakerMethod({url:"garage",method:"GET"}))}clear(){document.querySelectorAll(".garage__track").forEach((e=>{e.remove()}))}async createCar(e){const t=JSON.stringify(e);await this.loader.createRespOneCar(this.query.queryMakerPOSTQuery({url:"garage",method:"POST",header:{"Content-Type":"application/json"},body:t})),await this.start()}async generateCars(e){await Promise.all(e.map((async e=>await this.createCar(e)))),await this.start()}async deleteCar(e){const t=Number(e);await this.loader.deleteRespCar(this.query.queryMakerDELETEQuery({url:"garage",method:"DELETE",id:t}))}async getCar(e){const t=Number(e);return await this.loader.getRespOneCar(this.query.queryMakerGETOneQuery({url:"garage",method:"GET",id:t}))}async updateCar(e){const t=JSON.stringify(e);return await this.loader.updateCar(this.query.queryMakerUpdateQuery({url:"garage",id:Number(e.id),method:"PUT",header:{"Content-Type":"application/json"},body:t}))}async startStopEngine(e,t){return await this.loader.getStartStop(this.query.queryMakerEngine({url:"engine",method:"PATCH",id:e,status:t}))}async drive(e,t){return await this.loader.getDrive(this.query.queryMakerEngine({url:"engine",method:"PATCH",id:e,status:t}))}async createWinner(e){const t=JSON.stringify(e);await this.loader.createRespOneCar(this.query.queryMakerPOSTQuery({url:"winners",method:"POST",header:{"Content-Type":"application/json"},body:t}))}async getWinnersPage(){const t={url:"winners",method:"GET",page:e.pageWinners,limit:e.limitWin,sort:e.sort,order:e.sortOrder},n=await this.loader.getRespWinsPage(this.query.queryMakerWinnersPageQuery(t));return e.carsWin=n.carsWin,e.countWinners=n.countWin,n}async getWinners(){return await this.loader.getRespWins(this.query.queryMakerWinnersQuery({url:"winners",method:"GET",sort:"time",order:"ASC"}))}async getWinner(e){return await this.loader.getRespOneCar(this.query.queryMakerGETOneQuery({url:"winners",method:"GET",id:e}))}async deleteWinner(e){await this.loader.deleteRespCar(this.query.queryMakerDELETEQuery({url:"winners",method:"DELETE",id:e}))}async updateWinner(e){const t=JSON.stringify(e);return await this.loader.updateCar(this.query.queryMakerUpdateQuery({url:"winners",id:e.id,method:"PUT",header:{"Content-Type":"application/json"},body:t}))}},a=new r,i=new t,o=class{addListener(e,t,n){e instanceof NodeList?e.forEach((e=>{e.addEventListener(t,n)})):e.addEventListener(t,n)}readOptionsForCreateQuery(){const e=document.getElementById("create__name"),t=document.getElementById("create__color");return{url:"garage",method:"POST",header:{"Content-Type":"application/json"},data:{name:e.value,color:t.value}}}readOptionsForUpdateQuery(e){const t=document.getElementById("update__name"),n=document.getElementById("update__color");return{url:"garage",method:"PUT",header:{"Content-Type":"application/json"},data:{name:t.value,color:n.value,id:e}}}lockUnlockElement(e){e.classList.contains("disabled")?e.classList.remove("disabled"):e.classList.add("disabled")}generateCars(e){const t=["Lada","Nissan","Ford","Subaru","Kia","Mazda","Toyota","Suzuki","Renault","Hyunday","Honda","Volvo","UAZ","Skoda"],n=["Kalina","Jimny","Pathfinder","Explorer","Civic","Solaris","Accord","Patriot","XC70","Impreza","Camry","Land Rover","Discovery","Sandero","Priora","Rio","Cerato","Getz","Picanto","Optima","Rapid"];return new Array(e).fill(0).map((()=>({name:`${t[Math.floor(Math.random()*t.length)]} ${n[Math.floor(Math.random()*n.length)]}`,color:"#"+("00000"+Math.floor(Math.random()*Math.pow(16,6)).toString(16)).slice(-6)})))}async getdataWins(){const e=await a.getWinners(),t=await a.getGarage(),n=[];return e.forEach((e=>{t.forEach((t=>{if(t.id===e.id){const r=Object.assign({},t,e);n.push(r)}}))})),console.log("dataWin",e),console.log("dataCar",t),n}async getdataWinsPage(){console.log("stateWin",e.pageWinners);const t=await a.getWinnersPage(),n=await a.getGarage(),r=[];return t.carsWin.forEach((e=>{n.forEach((t=>{if(t.id===e.id){const n=Object.assign({},t,e);r.push(n)}}))})),console.log("dataWin",t),console.log("dataCar",n),r}async NumberWins(e){if(e.id&&e.time){const t=(await a.getWinners()).find((t=>t.id===e.id));if(void 0===t){const t={id:e.id,wins:1,time:e.time};await a.createWinner(t)}else if(e.time<t.time){const n={id:e.id,wins:t.wins+=1,time:e.time};await a.updateWinner(n)}else{const n={id:e.id,wins:t.wins+=1,time:t.time};await a.updateWinner(n)}}}paginationWinners(){const t=document.querySelector(".winners__pagination_next"),n=document.querySelector(".winners__pagination_prev");e.pageWinners*e.limitWin>e.countWinners&&t.classList.add("disabled"),document.body.addEventListener("click",(async r=>{const a=r.target;if(a===t){e.pageWinners++;const t=await this.getdataWinsPage();i.tableWinners(t)}if(a===n){e.pageWinners--;const t=await this.getdataWinsPage();i.tableWinners(t)}1===e.pageWinners?(n.classList.add("disabled"),t.classList.remove("disabled")):n.classList.remove("disabled"),e.pageWinners*e.limitWin<e.countWinners?t.classList.remove("disabled"):t.classList.add("disabled")}))}sortWinners(){const t=document.getElementById("sort__time_up"),n=document.getElementById("sort__time_down"),r=document.getElementById("sort__wins_up"),a=document.getElementById("sort__wins_down");document.body.addEventListener("click",(async o=>{const s=o.target;if(s===t){e.sort="time",e.sortOrder="ASC";const t=await this.getdataWinsPage();i.tableWinners(t)}if(s===n){e.sort="time",e.sortOrder="DESC";const t=await this.getdataWinsPage();i.tableWinners(t)}if(s===r){e.sort="wins",e.sortOrder="ASC";const t=await this.getdataWinsPage();i.tableWinners(t)}if(s===a){e.sort="wins",e.sortOrder="DESC";const t=await this.getdataWinsPage();i.tableWinners(t)}}))}};var s=n(379),c=n.n(s),d=n(767);c()(d.Z,{insert:"head",singleton:!1}),d.Z.locals;const l=new r,u=new o,g=new r,m=new o,_=new class{async startEngine(e){const t=document.getElementById(`btn_start_${e}`);document.getElementById(`btn_stop_${e}`).classList.remove("disabled"),t.classList.add("disabled");const n=await l.startStopEngine(e,"started"),r=n.distance/n.velocity;this.animation(e,r);const a=await l.drive(e,"drive");if(void 0===a){const t=document.getElementById(`img_block_${e}`),n=document.getElementById(`broke_${e}`);t&&n&&(t.getAnimations({subtree:!0}).map((e=>e.pause())),n.style.opacity="1")}return{id:e,timeAnimation:r,responce:a}}async stopEngine(e){const t=document.getElementById(`btn_start_${e}`),n=document.getElementById(`btn_stop_${e}`),r=document.getElementById(`broke_${e}`),a=document.getElementById(`finish_${e}`);t.classList.remove("disabled"),n.classList.add("disabled"),await l.startStopEngine(e,"stopped");const i=document.getElementById(`img_block_${e}`);i.getAnimations({subtree:!0}).map((e=>e.cancel())),i.style.transform="translate(0)",r.style.opacity="0",a.style.opacity="0"}async race(){const t=document.querySelector(".main__buttons__race-reset"),n=document.querySelector(".main__buttons__race-race");t.classList.add("disabled"),n.classList.add("disabled");const r=e.cars.map((async e=>await this.startEngine(e.id))),a=await this.raceAll(r,e.cars.map((e=>e.id)));return await u.NumberWins(a),document.querySelector(".winner_text_scoreboard").innerHTML=`${a.name} is winner,\ntime ${a.time} c`,console.log(a),await Promise.all(r),a}async raceAll(t,n){const{id:r,timeAnimation:a,responce:i}=await Promise.race(t);if(!i){const e=n.findIndex((e=>e===r)),a=[...t.slice(0,e),...t.slice(e+1,t.length)],i=[...n.slice(0,e),...n.slice(e+1,n.length)];return this.raceAll(a,i)}return{...e.cars.find((e=>e.id===r)),time:+(a/1e3).toFixed(2)}}raceAllAnimate(){document.getAnimations().forEach((async e=>{e.addEventListener("finish",(()=>{console.log("win",e.currentTime)}))}))}async resetRace(){const t=e.cars;await Promise.all(t.map((async e=>await this.stopEngine(e.id))))}animation(e,t){const n=document.querySelector(".garage__track__line")?.clientWidth,r=document.getElementById(`img_block_${e}`),a=document.getElementById(`finish_${e}`);if(r&&n){const e=r.animate([{transform:"translate(0)"},{transform:`translate(${n-245}px, 0)`}],t);if(e)return e.addEventListener("finish",(function(){r&&a&&(r.style.transform=`translate(${n-245}px, 0)`,a.style.opacity="1")})),e}}},p=new t,h=new r,y=new class{addListenerButtons(){document.body.addEventListener("click",(async t=>{const n=t.target,r=document.querySelector(".main__buttons__update");if(n.classList.contains("garage__track__head__buttons-remove")){const t=+n.id.split("btn_remove_")[1];await g.deleteCar(t.toString()),void 0!==(await g.getWinners()).find((e=>e.id===t))&&await g.deleteWinner(t),await g.start(),0===e.cars.length&&e.pageGarage>1&&(e.pageGarage--,await g.start())}if(n.classList.contains("main__buttons__create-create")){const t=m.readOptionsForCreateQuery();await g.createCar(t.data);const n=document.querySelector(".main__pagination-next"),r=document.getElementById("create__name"),a=document.getElementById("create__color");r.value="",a.value="#000000",e.pageGarage*e.limit<e.countCar&&n.classList.remove("disabled")}if(n.classList.contains("garage__track__head__buttons-select")&&r.classList.contains("disabled")){const e=+n.id.split("btn_select_")[1],t=await g.getCar(e.toString()),a=document.getElementById("update__name"),i=document.getElementById("update__color"),o=document.querySelector(".button_update");m.lockUnlockElement(r),a.value=t.name,i.value=t.color,o.addEventListener("click",(async()=>{m.lockUnlockElement(r);const t=m.readOptionsForUpdateQuery(e);await g.updateCar(t.data),a.value="",i.value="#000000",await g.start()}),{once:!0})}if(n.classList.contains("main__buttons__race-generate")){const t=e.generateCount,n=m.generateCars(t);await g.generateCars(n);const r=document.querySelector(".main__pagination-next");e.pageGarage*e.limit<e.countCar&&r.classList.remove("disabled")}}))}pagination(){const t=document.querySelector(".garage__head-page-number"),n=document.querySelector(".main__pagination-next"),r=document.querySelector(".main__pagination-prev");e.pageGarage*e.limit<e.countCar&&n.classList.remove("disabled"),document.body.addEventListener("click",(a=>{const i=a.target;i===n&&(e.pageGarage++,g.start()),i===r&&(e.pageGarage--,g.start()),t&&(t.innerHTML=e.pageGarage.toString()),1===e.pageGarage?(r.classList.add("disabled"),n.classList.remove("disabled")):r.classList.remove("disabled"),e.pageGarage*e.limit<e.countCar?n.classList.remove("disabled"):n.classList.add("disabled")}))}addListenerDriving(){document.body.addEventListener("click",(async e=>{const t=e.target;if(t.classList.contains("garage__track__line__buttons-start")){const e=+t.id.split("btn_start_")[1];_.startEngine(e)}if(t.classList.contains("garage__track__line__buttons-stop")){const e=+t.id.split("btn_stop_")[1];_.stopEngine(e)}if(t.classList.contains("main__buttons__race-race")){const e=document.querySelector(".main__buttons__race-reset");await _.race(),e.classList.remove("disabled")}if(t.classList.contains("main__buttons__race-reset")){await _.resetRace();const e=document.querySelector(".winner_text_scoreboard"),t=document.querySelector(".main__buttons__race-race");e.innerHTML="",t.classList.remove("disabled")}}))}viewGarageWinners(){document.body.addEventListener("click",(async t=>{const n=t.target,r=document.querySelector(".button_toGarage"),a=document.querySelector(".button_toWinners"),i=document.getElementById("view_garage"),o=document.getElementById("view_winners");if(n===r&&(o.style.display="none",i.style.display="block",m.lockUnlockElement(r),m.lockUnlockElement(a),e.view="garage"),n===a){i.style.display="none",o.style.display="block",m.lockUnlockElement(a),m.lockUnlockElement(r),e.view="winners";const t=await m.getdataWinsPage();p.tableWinners(t);const n=document.querySelector(".winners__pagination_next");e.pageWinners*e.limitWin<e.countWinners?n.classList.remove("disabled"):n.classList.add("disabled")}}))}},b=new t,f=new o;(async()=>{await h.start(),b.tableWinnersTemplate(),y.addListenerButtons(),y.pagination(),y.addListenerDriving(),y.viewGarageWinners(),f.paginationWinners(),f.sortWinners()})()})()})();